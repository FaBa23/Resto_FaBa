(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3459],{83236:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return n(40460)}])},40460:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return ek},default:function(){return eS}});var a=n(59658),r=n(46012),l=n(50404),o=n(78039),i=n(4036),s=n(29469),c=n(14296),d=n(950),m=n(49445),u=n(64e3),p=n(57971),f=n(41408),h=n(91222),g=n(21902),x=n(69656),v=n(24847),b=n(14796),_=n(21179),j=n(86690),y=n(14294),N=n(86309),w=n(64699),k=n(443),S=n(84813),C=n(42562),H=n(4357),Z=n(11512),L=n(42041),E=n(32161);let P=(0,r.createContext)({currentState:E.H.Landing,setCurrentState:()=>null,phoneNumber:"",setPhoneNumber:()=>null,countryCode:"",setCountryCode:()=>null,otp:{otp_token:"",otp_length:0},setOtp:()=>null,sendClickstreamEvent:()=>null,showLeaveModal:!1,setShowLeaveModal:()=>null,currentFlow:E.G.Login,setCurrentFlow:()=>null,customerForm:{},handleSuccessLogin:async()=>void 0,savedExitUrl:"",setSavedExitUrl:()=>null,pvToken:"",setPvToken:()=>null,isLoading:!1}),F=()=>(0,r.useContext)(P),T={name:"",email:""},O=()=>{let{handleSubmit:e,control:t,formState:{errors:n},watch:a,reset:r}=(0,H.cI)({mode:"onChange",defaultValues:T});return{handleSubmit:e,control:t,errors:n,watch:a,reset:r}};var z=n(16789);let M=()=>{let{setCurrentState:e,currentState:t,setSavedExitUrl:n}=F(),a=(0,i.useRouter)(),{t:l}=(0,s.Z)("login"),[o,c]=(0,r.useState)(!0);(0,z.Z)(o,l("unload_message"));let d=(0,r.useCallback)(a=>{switch(t){case E.H.FormName:case E.H.FormEmail:e(E.H.LeavingForm);break;case E.H.Otp:e(E.H.LeavingOtp)}throw n(a),"Route Canceled"},[t,e,n]);return(0,r.useEffect)(()=>(a.events.on("beforeHistoryChange",d),()=>{a.events.off("beforeHistoryChange",d)}),[a,t,n,e,d]),{removeHandler:()=>{c(!1),a.events.off("beforeHistoryChange",d)}}};var q=()=>{let{customerForm:e,handleSuccessLogin:t,countryCode:n,phoneNumber:l,pvToken:o,setCurrentState:i,sendClickstreamEvent:c}=F(),{handleSubmit:d,control:m,errors:u,watch:p}=e,{t:f}=(0,s.Z)("login"),{registerCustomerRequest:h,refreshToken:g}=(0,Z.Cb)(),[x,v]=(0,r.useState)(!1),[b,_]=(0,r.useState)(""),{removeHandler:j}=M(),y=(0,L.Z)(),N=async e=>{try{j();let a="".concat(n).concat(l);c({eventName:"Sign Up Email Saved",phone:a}),v(!0),_("");let r=await h({data:{...e,phone:(null==a?void 0:a.toString())||"",signed_up_country:y.countryCode,onboarding_partner:"GoFood-Web"}},o);[200,201].includes(r.status)&&(c({eventName:"Sign Up Succeed",phone:a}),await new Promise(e=>{setTimeout(async()=>e(await g()),1500)}),await t())}catch(e){var a,r,s;if((0,w.Z)(e,{identifier:Z.P$.signup_register}),null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:null===(a=r.errors)||void 0===a?void 0:a.length){let[t]=e.response.data.errors;if(c({eventName:"Web Signup error",phone:"".concat(n).concat(l),error:t}),t.code.includes("name")){i(E.H.InvalidName);return}_(t.message)}}finally{v(!1)}},P=!!u.email||!p("email");return(0,a.jsxs)("form",{onSubmit:d(N),className:"relative flex flex-1 flex-col md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gf-content-primary gf-heading-l",children:f("form_email_title")}),(0,a.jsx)("div",{className:"mt-2 text-gf-content-secondary gf-body-m",children:f("form_email_desc")}),(0,a.jsxs)("div",{className:"mt-8 w-full",children:[(0,a.jsx)(S.Z,{labelClassName:"mb-2",labelSize:"m",label:f("form_email_label"),required:!0}),(0,a.jsx)(H.Qr,{name:"email",control:m,rules:{required:!0,pattern:/^([a-zA-Z0-9+_\-.]+)@([a-zA-Z0-9_\-.]+)\.([a-zA-Z]{2,5})$/,maxLength:255,minLength:1},render:e=>{let{field:t}=e;return(0,a.jsx)(C.Z,{placeholder:f("form_email_placeholder"),isError:!!u.email,fieldSize:"l",isFullWidth:!0,...t})}}),u.email&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:f("error_email_invalid")})||""!==b&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:b})]})]}),(0,a.jsx)(k.default,{disabled:P,type:"submit",buttonSize:"l",variant:"primary",color:"brand",className:"mt-4 w-full",isLoading:x,children:f("form_email_cta")})]})},U=()=>{let{countryCode:e,phoneNumber:t,customerForm:n,setCurrentState:r,sendClickstreamEvent:l}=F(),{control:o,errors:i,watch:c}=n,{t:d}=(0,s.Z)("login");M();let m=!!i.name||!c("name");return(0,a.jsxs)("form",{onSubmit:n=>{n.preventDefault(),r(E.H.FormEmail),l({eventName:"Sign Up Name Saved",phone:"".concat(e).concat(t)})},className:"relative flex flex-1 flex-col md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gf-content-primary gf-heading-l",children:d("form_name_title")}),(0,a.jsx)("div",{className:"mt-2 text-gf-content-secondary gf-body-m",children:d("form_name_desc")}),(0,a.jsxs)("div",{className:"mt-8 w-full",children:[(0,a.jsx)(S.Z,{labelClassName:"mb-2",labelSize:"m",label:d("form_name_label"),required:!0}),(0,a.jsx)(H.Qr,{name:"name",control:o,rules:{required:!0,maxLength:128,minLength:2},render:e=>{let{field:t}=e;return(0,a.jsx)(C.Z,{placeholder:d("form_name_placeholder"),isError:!!i.name,fieldSize:"l",isFullWidth:!0,...t})}}),i.name&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:d("error_name_invalid",{limit:"".concat(2,"-").concat(128)})})]})]}),(0,a.jsx)(k.default,{disabled:m,type:"submit",buttonSize:"l",variant:"primary",color:"brand",className:"mt-4 w-full",children:d("form_name_cta")})]})},I=n(6209),G=()=>{let{setCurrentState:e}=F(),{t}=(0,s.Z)("login");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{}),(0,a.jsx)("p",{className:"text-gf-content-primary gf-heading-xl",children:t("invalid_name_title")}),(0,a.jsx)("p",{className:"mt-2 text-gf-content-secondary gf-body-m",children:t("invalid_name_desc")}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"primary",color:"brand",className:"mt-8 w-full",onClick:()=>{e(E.H.FormName)},children:t("invalid_name_cta_change")})]})},$=n(3168),W=()=>{let{setCurrentState:e,isLoading:t}=F(),{t:n}=(0,s.Z)("login"),{sendEvent:r,clickstream:l}=(0,f.k)(),o=()=>{e(E.H.PhoneNumber)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.Z,{}),(0,a.jsx)("p",{className:"text-gf-content-primary gf-heading-xl",children:n("welcome")}),(0,a.jsx)("p",{className:"mt-2 text-gf-content-secondary gf-body-m",children:n("login_landing_hero")}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"primary",color:"brand",className:"mt-4 w-full",onClick:o,isLoading:t,disabled:t,children:n("cta_login")}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"secondary",color:"brand",className:"mt-4 mb-14 w-full",onClick:()=>{l&&r("Sign Me Up Clicked","Component"),o()},isLoading:t,disabled:t,children:n("cta_sign_up")})]})},V=n(28802),D=n(10269),R=e=>{let{isOpen:t,closeModal:n}=e,{t:r}=(0,s.Z)("login");return(0,a.jsxs)(D.Z,{isOpen:t,onClose:n,withContentHeight:!0,cardClassName:"md:w-[380px] lg:w-[440px]",children:[(0,a.jsx)("p",{className:"mb-2 text-gf-content-primary gf-label-l",children:r("confirm_leave_login_popup_title")}),(0,a.jsx)("p",{className:"text-gf-content-secondary gf-body-m",children:r("confirm_leave_login_popup_body")}),(0,a.jsxs)("div",{className:"mt-6 flex items-center",children:[(0,a.jsx)(k.default,{as:V.r,variant:"primary",buttonSize:"m",color:"brand",className:"mr-2 py-1 px-8 md:px-4",href:"/",children:r("yes_leave_login")}),(0,a.jsx)(k.default,{variant:"secondary",buttonSize:"m",color:"brand",className:"py-1 px-8 md:px-4",onClick:()=>{n()},children:r("no_leave_login")})]})]})},A=n(36040);let B=e=>{let{backDestinationScreen:t,defaultExitDestinationScreen:n,title:r,description:l,backCta:o,exitCta:s}=e,{savedExitUrl:c,setCurrentState:d,setSavedExitUrl:m,sendClickstreamEvent:u,countryCode:p,phoneNumber:f}=F(),h=(0,i.useRouter)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A.Z,{}),(0,a.jsx)("p",{className:"text-gf-content-primary gf-heading-xl",children:r}),(0,a.jsx)("p",{className:"mt-2 text-gf-content-secondary gf-body-m",children:l}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"primary",color:"brand",className:"mt-6 w-full",onClick:()=>{d(t)},children:o}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"secondary",color:"brand",className:"mt-4 w-full",onClick:()=>{u({eventName:"Sign Up Abandoned",phone:"".concat(p).concat(f)}),""!==c?(m(""),h.push(c)):d(n)},children:s})]})};var Q=()=>{let{t:e}=(0,s.Z)("login");return(0,a.jsx)(B,{backDestinationScreen:E.H.FormName,defaultExitDestinationScreen:E.H.Landing,title:e("leaving_form_title"),description:e("leaving_form_desc"),backCta:e("leaving_form_cta_back"),exitCta:e("leaving_form_cta_exit")})},X=()=>{let{t:e}=(0,s.Z)("login");return(0,a.jsx)(B,{backDestinationScreen:E.H.Otp,defaultExitDestinationScreen:E.H.Landing,title:e("leaving_otp_title"),description:e("leaving_otp_desc"),backCta:e("leaving_otp_cta_back"),exitCta:e("leaving_otp_cta_exit")})},K=n(67846),J=n(22807),Y=n(73409),ee=n(38443),et=n.n(ee),en=n(78115),ea=n(48456),er=n(91885),el=e=>{let{children:t}=e,{currentState:n,setCurrentState:l,setShowLeaveModal:o,currentFlow:i}=F(),{lang:c}=(0,s.Z)("login"),{getQueryAsString:d}=(0,y.o)(),{isTiktok:m,isGopay:u}=(0,b.Z)(),p=(0,r.useMemo)(()=>n===E.H.Otp?"https://www.gojek.com/en-id/help/akun/saya-belum-menerima-kode-otp/":"https://www.gojek.com/id-id/help/gofoodweb/cara-masuk-ke-akun-gojek/",[n]);return(0,a.jsxs)("section",{className:"flex h-[calc(100vh-55px)] w-full items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute h-[calc(100vh-55px)] w-full",children:(0,a.jsx)(er.Z,{className:"shrink-0 grow-0 object-cover",src:ea.fb,alt:"Gofood background",fill:!0,placeholder:"empty",priority:!0})}),(0,a.jsxs)("div",{className:(0,en.m)("fixed top-0 left-0 z-20 flex h-screen min-h-[520px] w-full flex-col bg-gf-background-fill-primary p-6 pb-8 md:left-1/2 md:top-[52.5%] md:h-auto md:max-w-[462px] md:-translate-x-1/2 md:-translate-y-1/2 md:rounded-2xl md:gf-shadow-high"),id:"login-card",children:[n===E.H.Landing?(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"relative mr-4 flex h-[30px] w-[112px] shrink-0 grow-0 cursor-pointer",children:(0,a.jsx)(er.Z,{className:"shrink-0 grow-0 object-contain",src:ea.yg,alt:"Gofood logo",fill:!0,placeholder:"empty",priority:!0})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{role:"button","aria-pressed":"false",onClick:()=>{o(!0)},children:(0,a.jsx)(Y.Z,{className:"w-[22px] text-gf-link-default"})})})]}):(0,a.jsxs)("div",{className:(0,en.m)([E.H.Terms,E.H.LeavingForm,E.H.LeavingOtp,E.H.InvalidName].includes(n)?"mb-0":"mb-6 md:mb-[72px]","relative  flex items-center justify-between"),children:[(0,a.jsxs)("div",{className:"flex w-[124px] items-center",role:"button","aria-pressed":"false",onClick:()=>{switch(n){case E.H.PhoneNumber:if(m||u){window.location.href=(0,N.t$)("/"+d(),c);return}l(E.H.Landing);break;case E.H.Terms:l(E.H.PhoneNumber);break;case E.H.Otp:l(i===E.G.Login?E.H.PhoneNumber:E.H.LeavingOtp);break;case E.H.FormName:l(E.H.LeavingForm);break;case E.H.FormEmail:case E.H.LeavingForm:case E.H.InvalidName:l(E.H.FormName);break;case E.H.LeavingOtp:l(E.H.Otp)}},children:[(0,a.jsx)("div",{children:(0,a.jsx)(J.Z,{className:"w-[18px] text-gf-link-default"})}),(0,a.jsx)("div",{className:"relative left-6 h-[30px] w-[112px] shrink-0 grow-0 cursor-pointer",children:(0,a.jsx)(er.Z,{className:"shrink-0 grow-0 object-contain",src:ea.yg,alt:"Gofood logo",fill:!0,placeholder:"empty",priority:!0})})]}),n!==E.H.Terms&&(0,a.jsx)(et(),{href:p||"",passHref:!0,target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)(K.Z,{className:"w-[22px] text-gf-link-default"})})]}),t]})]})},eo=n(70426),ei=n(3660);let es="https://ca.turing.captcha.qcloud.com/TJNCaptcha-global.js";var ec=()=>{let[e,t]=(0,r.useState)(!1),[n,a]=(0,r.useState)(null),l=(0,r.useCallback)((e,t)=>({ret:0,ticket:"trerror_".concat(e,"_").concat(ei.Oi,"_").concat(Math.floor(new Date().getTime()/1e3)),randstr:"@"+Math.random().toString(36).substr(2),errorCode:e,errorMessage:t,error:t}),[]);return(0,r.useEffect)(()=>{if(document.querySelector('script[src="'.concat(es,'"]'))){t(!0);return}let e=document.createElement("script");e.src=es,e.async=!0,e.onload=()=>{t(!0)},e.onerror=()=>{a("Failed to load Tencent Captcha script")},document.head.appendChild(e);let n=document.getElementById("tencent-captcha-container");return n||((n=document.createElement("div")).id="tencent-captcha-container",document.body.appendChild(n)),()=>{let e=document.querySelector('script[src="'.concat(es,'"]'));e&&e.remove();let t=document.getElementById("tencent-captcha-container");t&&t.remove()}},[]),{getTicket:(0,r.useCallback)(()=>new Promise(t=>{if(n){t(l(1001,n));return}if(!e){t(l(1001,"Captcha script not loaded"));return}if(void 0===window.TencentCaptcha){t(l(1001,"TencentCaptcha not available"));return}try{let e=document.getElementById("tencent-captcha-container");if(!e){t(l(1002,"Captcha container not found"));return}new window.TencentCaptcha(e,ei.Oi,e=>{0===e.ret?t({ret:e.ret,ticket:e.ticket||"",randstr:e.randstr,errorCode:e.errorCode,errorMessage:e.errorMessage}):2===e.ret?t({ret:e.ret,ticket:"",randstr:e.randstr,error:"User closed captcha"}):t(l(1003,"Captcha returned error code: ".concat(e.ret)))},{}).show()}catch(n){let e=n instanceof Error?n.message:"Unknown error";t(l(1004,"Captcha error: ".concat(e)))}}),[e,n,l]),scriptLoaded:e,error:n}},ed=n(581),em=()=>{var e;let{t}=(0,s.Z)("login"),{otp:n,phoneNumber:l,setOtp:o,countryCode:i,sendClickstreamEvent:c,currentFlow:m,setCurrentState:p,handleSuccessLogin:f,customerForm:h,setPvToken:g}=F(),{grantOtp:x,resendOtp:v}=(0,Z.Cb)(),[_,j]=(0,d.Z)(u.at),{removeHandler:y}=M(),{isTiktok:N}=(0,b.Z)(),[S,L]=(0,r.useState)(!1),[P,O]=(0,r.useState)(!1),[z,q]=(0,r.useState)(""),[U,I]=(0,r.useState)(!1),[G,$]=(0,r.useState)(!1),[W,V]=(0,r.useState)(),{handleSubmit:D,control:R,formState:{errors:A},watch:B}=(0,H.cI)({mode:"onChange",defaultValues:{grant_type:"otp",data:{otp:"",otp_token:null==n?void 0:n.otp_token}}}),Q=e=>{var t;let n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.signup_request_user.phone_verification_token;if(!n)throw Error("phone_verification_token is not present");g(n),h.reset(T),p(E.H.FormName)},X=async e=>{let t=m===E.G.Login;try{y(),L(!0),q("");let n=await x(e,m),a="".concat(i).concat(l);if([200,201].includes(n.status)){if(j("true"),t){c({eventName:"Log in OTP Validated".concat(N?" - Tiktok":""),phone:a}),f();return}c({eventName:"Sign Up OTP Validated",phone:a}),Q(n.data)}}catch(e){var n,a,r,o,s,d;(null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:null===(n=a.errors)||void 0===n?void 0:n.length)&&(c({eventName:t?"Login Invalid OTP".concat(N?" - Tiktok":""):"Sign Up Invalid OTP",phone:"".concat(i).concat(l),error:null===(s=e.response)||void 0===s?void 0:s.data.errors[0]}),q(null===(d=e.response)||void 0===d?void 0:d.data.errors[0].message)),(null===(o=e.response)||void 0===o?void 0:o.status)===429&&(I(!0),Y()),(0,w.Z)(e,{identifier:t?Z.P$.otp:Z.P$.signup_otp})}finally{L(!1)}},{getTicket:K}=ec(),J=(0,r.useCallback)(async()=>{if(n)try{O(!0),q("");let e=await K();if(2===e.ret){q(e.errorMessage||t("common:failed_general")),(0,w.Z)(Error(e.errorMessage||"User closed captcha"),{identifier:Z.P$.captcha_error});return}let a=await v(n.otp_token,e.ticket);[200,201].includes(a.status)&&o(a.data.data)}catch(e){q(t("common:failed_network_error")),(0,w.Z)(e,{identifier:Z.P$.otp_retry})}finally{O(!1)}},[K,n,v,o,t]),Y=()=>{$(!0),V(void 0)},ee=!!(null===(e=A.data)||void 0===e?void 0:e.otp)||!B("data.otp");return(0,r.useEffect)(()=>{U&&setTimeout(()=>{I(!1)},9e5)},[U]),(0,r.useEffect)(()=>{var e;n&&($(!1),V(null!==(e=n.otp_expires_in)&&void 0!==e?e:n.expires_in))},[n]),(0,a.jsxs)("form",{onSubmit:D(X),className:"relative flex flex-1 flex-col md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gf-content-primary gf-heading-xl",children:t("otp_input_page_title")}),(0,a.jsx)("p",{className:"mt-2 mb-8 text-gf-content-secondary gf-body-m",children:t("otp_input_page_desc",{phoneNumber:"".concat(i).concat(l)})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"mb-2 gf-label-m",children:t("input_label_otp")}),(0,a.jsx)("span",{className:"text-gf-support-danger-default",children:" *"})]}),(0,a.jsx)("div",{className:"w-[70px]",children:!U&&void 0!==W&&(0,a.jsx)(eo.Z,{duration:W,onTimeUp:Y})})]}),(0,a.jsx)(H.Qr,{name:"data.otp",control:R,rules:{maxLength:4,minLength:4},render:e=>{var n;let{field:r}=e;return(0,a.jsx)(C.Z,{id:"otp",placeholder:t("placeholder_otp"),isError:!!(null===(n=A.data)||void 0===n?void 0:n.otp),isFullWidth:!0,type:"tel",...r,onChange:e=>r.onChange((0,ed.rL)(e.target.value))})}})]}),""!==z&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:z}),(0,a.jsx)(k.default,{disabled:!G||U,isLoading:P,type:"button",buttonSize:"m",variant:"nude",color:"brand",className:"mx-auto mt-4 block !border-none !bg-transparent md:mt-6",onClick:J,children:t("resend_otp")})]}),(0,a.jsx)(k.default,{disabled:ee,type:"submit",buttonSize:"l",variant:"primary",color:"brand",className:"mt-4 w-full",isLoading:S,children:t("continue")})]})},eu=n(28892),ep=n.n(eu),ef=e=>{let{flag:t,fieldSize:n}=e;return(0,a.jsx)("span",{className:(0,en.m)("l"===n&&"text-[32px]","m"===n&&"text-[28px]","s"===n&&"text-[24px]"),children:t})},eh=e=>{let{data:t,fieldSize:n}=e;return(0,a.jsx)(ep().Option,{value:t,children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ef,{flag:t.flag,fieldSize:n}),(0,a.jsx)("span",{children:t.name})]})},t.code)},eg=n(65014);let ex=(0,r.forwardRef)((e,t)=>{let{value:n,selectedCountry:r,onChange:l,onChangeCountry:o,...i}=e,{fieldSize:c="m"}=i,{t:d}=(0,s.Z)();return(0,a.jsxs)(ep(),{textFieldValue:n,onChangeTextField:l,onSelectOption:e=>o(e),renderValue:()=>(0,a.jsxs)("div",{className:"ml-4 flex cursor-pointer items-center space-x-2",children:[(0,a.jsx)(ef,{flag:r.flag,fieldSize:c}),(0,a.jsx)("span",{className:"ml-2 block",children:r.code})]}),inputType:"tel",ref:t,testId:"phone-number-field",...i,children:[(0,a.jsx)("span",{className:"mx-4 block py-2 gf-label-s",children:d("common:popular_countries")}),eg.qR.map((e,t)=>(0,a.jsx)(eh,{data:e,fieldSize:c},"".concat(e.code,"-").concat(t))),(0,a.jsx)("span",{className:"mx-4 block py-2 gf-label-s",children:d("common:all_countries")}),eg.Oc.map((e,t)=>(0,a.jsx)(eh,{data:e,fieldSize:c},"".concat(e.code,"-").concat(t)))]})});ex.displayName="PhoneNumberField";var ev=n(58460);let eb=eg.qR[0];var e_=()=>{let{setCurrentState:e,setOtp:t,phoneNumber:n,setPhoneNumber:l,setCountryCode:o,sendClickstreamEvent:i,setCurrentFlow:m,handleSuccessLogin:f}=F(),{hasRecentlyLoggedOut:h,setHasRecentlyLoggedOut:v}=(0,ev.aC)(),{handleSubmit:j,watch:y,control:N,setValue:S,formState:{errors:C}}=(0,H.cI)({mode:"onSubmit",defaultValues:{phone_number:n,country_code:eb.code}}),{sendLoginRequest:L}=(0,Z.Cb)(),{generateToken:P}=(0,_.M)(),{isTiktok:T}=(0,b.Z)(),{loginData:O,login:z}=(0,g.Z5)(),{showToaster:M}=(0,x.Ps)(),[q,U]=(0,c.Z)(p.X),[I,G]=(0,d.Z)(u.at),{t:$}=(0,s.Z)("login"),[W,V]=(0,r.useState)(eb),[D,R]=(0,r.useState)(!1),[A,B]=(0,r.useState)(""),Q=e=>{V(e),S("country_code",e.code)},X=async()=>{m(E.G.Signup),e(E.H.Terms)},{getTicket:K}=ec(),J=async n=>{try{h&&v(!1),R(!0),B(""),o(n.country_code),l(n.phone_number);let a="".concat(n.country_code).concat(n.phone_number);if(T&&a===(null==O?void 0:O.phoneNumber)&&(null==O?void 0:O.extVerifToken)&&(null==O?void 0:O.transactionId))try{let{extVerifToken:e,transactionId:t}=O;await P(e,t),i({eventName:"Web Login Submitted - Tiktok",phone:a}),U(!0),G("true"),f()}catch(e){(0,w.Z)(e,{identifier:"Tiktok - generateToken"}),M({content:$("common:failed_network_error")}),z()}else{i({eventName:"Web Login Submitted",phone:a});let r=await K();if(2===r.ret){B(r.errorMessage||$("common:failed_general")),(0,w.Z)(Error(r.errorMessage||"User closed captcha"),{identifier:Z.P$.captcha_error});return}let l=await L(n,r.ticket);[200,201].includes(l.status)&&(t(l.data.data),e(E.H.Otp))}}catch(e){var a,r,s,c,d,m,u,p;if((null===(a=e.response)||void 0===a?void 0:a.status)===401){X();return}(null===(r=e.response)||void 0===r?void 0:r.status)===400&&i({eventName:"Sign Up Invalid Number",phone:"".concat(n.country_code).concat(n.phone_number)}),(null===(d=e.response)||void 0===d?void 0:null===(c=d.data)||void 0===c?void 0:null===(s=c.errors)||void 0===s?void 0:s.length)&&(i({eventName:"Web Login error".concat(q?" - Tiktok":""),phone:"".concat(n.country_code).concat(n.phone_number),error:null===(u=e.response)||void 0===u?void 0:u.data.errors[0]}),B(null===(p=e.response)||void 0===p?void 0:p.data.errors[0].message)),(null===(m=e.response)||void 0===m?void 0:m.status)===429&&B($("common:error_rate_limited")),(0,w.Z)(e,{identifier:Z.P$.login})}finally{R(!1)}};(0,r.useEffect)(()=>{m(E.G.Login)},[]);let Y=!!C.phone_number||!y("phone_number");return(0,a.jsxs)("form",{className:"flex flex-1 flex-col md:justify-between",onSubmit:j(J),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gf-content-primary gf-heading-xl",children:$("phone_number_page_title")}),(0,a.jsx)("p",{className:"mt-2 mb-6 text-gf-content-secondary gf-body-m",children:$("phone_number_page_desc_mvp_login")}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"mb-2 gf-label-m",children:$("input_label_phone_number")}),(0,a.jsx)("span",{className:"text-gf-support-danger-default",children:" *"})]}),(0,a.jsx)(H.Qr,{name:"phone_number",control:N,rules:{required:!0,minLength:8,maxLength:17},render:e=>{let{field:t}=e;return(0,a.jsx)(ex,{isFullWidth:!0,selectedCountry:W,onChangeCountry:Q,isError:!!C.phone_number,placeholder:$("placeholder_phone_number"),...t,onChange:e=>t.onChange((0,ed.rL)(e.target.value))})}}),C.phone_number&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:$("error_phone_invalid",{limit:"".concat(8,"-").concat(17)})})||""!==A&&(0,a.jsx)("p",{className:"mt-2 text-gf-content-muted gf-body-m",children:A})]})]}),(0,a.jsx)(k.default,{type:"submit",buttonSize:"l",variant:"primary",color:"brand",className:"mt-4 w-full",disabled:Y,isLoading:D,children:(0,a.jsx)("span",{children:$("continue")})})]})},ej=n(49627),ey=n(20341),eN=()=>{let{countryCode:e,phoneNumber:t,setCurrentState:n,setOtp:l,sendClickstreamEvent:o}=F(),{t:i,lang:c}=(0,s.Z)("login"),{createCustomerRequest:d}=(0,Z.Cb)(),{showToaster:m}=(0,x.Ps)(),[u,p]=(0,r.useState)(!1),{getTicket:f}=ec(),h=async()=>{let a="".concat(e).concat(t);try{p(!0);let e=await f();if(2===e.ret){m({content:e.errorMessage||i("common:failed_general")}),(0,w.Z)(Error(e.errorMessage||"User closed captcha"),{identifier:Z.P$.captcha_error});return}o({eventName:"Web Signup Submitted",phone:a,recaptchaToken:e.ticket});let t=await d({phone:a},e.ticket);[200,201].includes(t.status)&&(l(t.data.data),n(E.H.Otp))}catch(e){var r,s,c,u,h;(null===(c=e.response)||void 0===c?void 0:null===(s=c.data)||void 0===s?void 0:null===(r=s.errors)||void 0===r?void 0:r.length)&&(o({eventName:"Web Signup error",phone:a,error:null===(u=e.response)||void 0===u?void 0:u.data.errors[0]}),m({content:null===(h=e.response)||void 0===h?void 0:h.data.errors[0].message})),(0,w.Z)(e,{identifier:Z.P$.signup_new})}finally{p(!1)}},g=e=>(0,a.jsx)(et(),{href:(0,N.eg)(e.url,c),passHref:!0,className:"text-gf-content-brand underline decoration-2 gf-label-s",target:"_blank",rel:"noopener noreferrer",children:e.url});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej.Z,{}),(0,a.jsx)("div",{className:"text-gf-content-primary gf-heading-l",children:i("terms_title")}),(0,a.jsx)("div",{className:"mt-6 text-gf-content-secondary gf-body-s",children:(0,a.jsx)(ey.Z,{i18nKey:"login:terms_desc",components:[(0,a.jsx)(g,{url:ei.Kr},0),(0,a.jsx)(g,{url:ei.fe},1)]})}),(0,a.jsx)(k.default,{buttonSize:"l",variant:"primary",color:"brand",className:"mt-8 w-full",onClick:h,isLoading:u,children:i("terms_cta")})]})},ew=e=>{var t;let{navbarSetting:n={}}=e,{isMobile:l}=(0,j.Z)(),[k,S]=(0,r.useState)(E.H.Landing),[C,H]=(0,r.useState)(E.G.Login),[Z,L]=(0,r.useState)(!1),[F,T]=(0,r.useState)(""),z=O(),[M,I]=(0,r.useState)(""),[$,V]=(0,r.useState)(),[D,A]=(0,r.useState)(""),[B,K]=(0,r.useState)(""),[J,Y]=(0,r.useState)(!1);(0,v.n)({showLocationPickerNavbar:null===(t=e.navbarSetting)||void 0===t?void 0:t.showLocationPickerNavbar});let ee=(0,r.useMemo)(()=>{switch(k){case E.H.PhoneNumber:return(0,a.jsx)(e_,{});case E.H.Otp:return(0,a.jsx)(em,{});case E.H.Terms:return(0,a.jsx)(eN,{});case E.H.FormName:return(0,a.jsx)(U,{});case E.H.FormEmail:return(0,a.jsx)(q,{});case E.H.LeavingForm:return(0,a.jsx)(Q,{});case E.H.LeavingOtp:return(0,a.jsx)(X,{});case E.H.InvalidName:return(0,a.jsx)(G,{});case E.H.Landing:default:return(0,a.jsx)(W,{})}},[k]),{clickstream:et,getDefaultPayload:en,sendEvent:ea}=(0,f.k)(),er=(0,r.useCallback)(e=>{let{eventName:t,phone:n,error:a,recaptchaToken:r}=e;if(!et)return;let l=en();ea(t,"Component",{...l,meta:{...l.meta,customer:{...l.meta.customer,phone:n},...r?{recaptcha:{token:r}}:{}},...a?{error:{code:a.code,message:a.message}}:{}})},[et,en,ea]),eo=(0,i.useRouter)(),{ref:ei,isPhoneNumber:es,phoneNumber:ec}=eo.query,{getQueryAsString:ed}=(0,y.o)(),{t:eu,lang:ep}=(0,s.Z)("common"),{showToaster:ef}=(0,x.Ps)(),eh=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(C===E.G.Signup&&ef({content:(0,a.jsxs)("div",{className:"flex items-center text-gf-content-primary gf-body-m",children:[(0,a.jsx)("div",{className:"mr-4 h-16 w-16",children:(0,a.jsx)(o.Z,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:eu("toaster_new_account_title")}),(0,a.jsx)("div",{children:eu("toaster_new_account_subtitle")})]})]}),className:"md:max-w-[350px]"}),ei){let e=(0,N.Gw)(eo.query,["isPhoneNumber","ref"]);await eo.push({pathname:ei,query:e})}else e?await eo.push((0,N.t$)("/gofood-pas"+ed(),ep)):await eo.push((0,N.t$)("/"+ed(),ep))},[C,ed,ep,ei,eo,ef,eu]),{isTiktok:eg,isGopay:ex}=(0,b.Z)(),{login:ev,currentInstance:eb}=(0,g.Z5)(),{login:ej,loginData:ey}=(0,h.WO)(),{generateToken:ew}=(0,_.M)(),[ek,eS]=(0,c.Z)(p.X),[eC,eH]=(0,d.Z)(u.at);(0,r.useEffect)(()=>{eg&&eb&&!es&&k===E.H.Landing&&(Y(!0),ev())},[eb,k,eg]),(0,r.useEffect)(()=>{ex&&!es&&k===E.H.Landing&&(Y(!0),ej())},[k,ex]);let eZ=(0,r.useCallback)(async(e,t)=>{await ew(e,t),eS(!0),eH("true"),await eh(!0)},[ew,eh,eS,eH]);(0,r.useEffect)(()=>{if(eg&&"true"===es){S(E.H.PhoneNumber),Y(!1);let e={...eo.query};delete e.isPhoneNumber,ec&&(A(ec),delete e.phoneNumber),eo.push({query:e},void 0,{shallow:!0})}},[es]),(0,r.useEffect)(()=>{if(ex&&"true"===es&&ey)try{let{extVerifToken:e,transactionId:t}=ey;e&&t&&eZ(e,t)}catch(e){(0,w.Z)(e,{identifier:"Gopay - generateToken"})}finally{Y(!1)}},[es,ex,ey]);let eL=(0,r.useMemo)(()=>({currentState:k,setCurrentState:S,phoneNumber:D,setPhoneNumber:A,countryCode:B,setCountryCode:K,otp:$,setOtp:V,sendClickstreamEvent:er,showLeaveModal:Z,setShowLeaveModal:L,currentFlow:C,setCurrentFlow:H,customerForm:z,handleSuccessLogin:eh,savedExitUrl:F,setSavedExitUrl:T,pvToken:M,setPvToken:I,isLoading:J}),[B,k,$,D,er,Z,C,H,z,eh,F,T,M,I,J]);return(0,a.jsxs)(a.Fragment,{children:[!l&&(0,a.jsx)(m.Z,{...n}),(0,a.jsx)(P.Provider,{value:eL,children:(0,a.jsx)(el,{children:ee})}),k===E.H.Landing&&(0,a.jsx)(R,{isOpen:Z,closeModal:()=>L(!1)})]})},ek=!0,eS=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.PB,{noindex:!0,nofollow:!0}),(0,a.jsx)(ew,{})]})}},function(e){e.O(0,[4357,2241,5014,2888,9774,179],function(){return e(e.s=83236)}),_N_E=e.O()}]);